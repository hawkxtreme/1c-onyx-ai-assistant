#Область ПрограммныйИнтерфейс

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	СсылкиНаСессии = ПолучитьСсылкиНаСессии(ПараметрКоманды);
	Если СсылкиНаСессии.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Для Каждого СсылкаНаСессию Из СсылкиНаСессии Цикл
		Попытка
			ОбновитьСессиюНаСервере(СсылкаНаСессию);
		Исключение
			Сообщить(СтрШаблон(
				"Не удалось обновить сессию %1. %2",
				Строка(СсылкаНаСессию),
				ОписаниеОшибки()));
		КонецПопытки;
	КонецЦикла;
	
	ПараметрыВыполненияКоманды.Источник.Список.Обновить();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Функция ПолучитьСсылкиНаСессии(ПараметрКоманды)
	
	Результат = Новый Массив;
	
	Если Не ЗначениеЗаполнено(ПараметрКоманды) Тогда
		Возврат Результат;
	КонецЕсли;
	
	ТипСправочника = Тип("СправочникСсылка.onyx_СессииЧата");
	
	ВыбранныйТип = ТипЗнч(ПараметрКоманды);
	
	Если ВыбранныйТип = ТипСправочника Тогда
		Результат.Добавить(ПараметрКоманды);
	ИначеЕсли ВыбранныйТип = Тип("Массив") Тогда
		Для Каждого ВозможнаяСсылка Из ПараметрКоманды Цикл
			Если ЗначениеЗаполнено(ВозможнаяСсылка)
				И ТипЗнч(ВозможнаяСсылка) = ТипСправочника Тогда
				Результат.Добавить(ВозможнаяСсылка);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

&НаСервере
Процедура ОбновитьСессиюНаСервере(СсылкаНаСессию)
	
	Если Не ЗначениеЗаполнено(СсылкаНаСессию) Тогда
		Возврат;
	КонецЕсли;
	
	onyx_РаботаССессиямиЧата.ОбновитьМетаданныеСессии(СсылкаНаСессию);
	
КонецПроцедуры

#КонецОбласти

